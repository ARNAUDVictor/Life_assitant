{% extends "base.html" %}
{% from 'components/task_card.html' import task_card %}

{% block title %}Gestionnaire de TÃ¢ches | ({{ tasks|length }}){% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tasks.css') }}">
{% endblock %}

{% block content %}
    <div class="container">
        <h1>ğŸ“ Gestionnaire de TÃ¢ches</h1>
        
        <!-- Formulaire pour ajouter une tÃ¢che -->
        <div class="add-task">
            <form method="POST" action="{{ url_for('tasks.add_task') }}">
            <div class="form-row">
                <input type="text" name="title" placeholder="Nouvelle tÃ¢che..." required class="task-input">
                <select name="category_id" class="category-select">
                <option value="">ğŸ“ CatÃ©gorie</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
                </select>
                <input type="datetime-local" name="due_date" class="date-input">
                <button type="submit" class="btn-add">Ajouter</button>
            </div>
            </form>
        </div>

        <!-- TÃ¢ches en cours -->
        <div class="tasks-section">
            <h2>En cours <span class="task-count">({{ tasks|selectattr('completed', 'equalto', false)|list|length }})</span></h2>
            {% set active_tasks = tasks|selectattr('completed', 'equalto', false)|list %}
            {% if active_tasks %}
                {% for task in active_tasks %}
                    {{ task_card(task) }}
                {% endfor %}
            {% else %}
                <p class="empty">Aucune tÃ¢che en cours. Profitez-en ! ğŸ‰</p>
            {% endif %}
        </div>

        <!-- TÃ¢ches terminÃ©es -->
        <div class="completed-section">
            <h2 class="completed-header">TerminÃ©es <span class="task-count">({{ tasks|selectattr('completed', 'equalto', true)|list|length }})</span></h2>
            {% set completed_tasks = tasks|selectattr('completed', 'equalto', true)|list %}
            {% if completed_tasks %}
                {% for task in completed_tasks %}
                    {{ task_card(task) }}
                {% endfor %}
            {% else %}
                <p class="empty">Aucune tÃ¢che terminÃ©e pour le moment.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}